<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Building Liferay widgets with React | xrazis | Haris Razis</title><meta name=keywords content="React,Liferay"><meta name=description content="How to build a React portlet on Liferay 7.2 with widgets"><meta name=author content><link rel=canonical href=https://haris.razis.com/posts/building-liferay-widgets-with-react/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://haris.razis.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://haris.razis.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://haris.razis.com/favicon.png><link rel=apple-touch-icon href=https://haris.razis.com/apple-touch-icon.png><link rel=mask-icon href=https://haris.razis.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Building Liferay widgets with React"><meta property="og:description" content="How to build a React portlet on Liferay 7.2 with widgets"><meta property="og:type" content="article"><meta property="og:url" content="https://haris.razis.com/posts/building-liferay-widgets-with-react/"><meta property="og:image" content="https://haris.razis.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-25T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-25T00:00:00+00:00"><meta property="og:site_name" content="xrazis"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://haris.razis.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Building Liferay widgets with React"><meta name=twitter:description content="How to build a React portlet on Liferay 7.2 with widgets"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://haris.razis.com/posts/"},{"@type":"ListItem","position":2,"name":"Building Liferay widgets with React","item":"https://haris.razis.com/posts/building-liferay-widgets-with-react/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Building Liferay widgets with React","name":"Building Liferay widgets with React","description":"How to build a React portlet on Liferay 7.2 with widgets","keywords":["React","Liferay"],"articleBody":"Introduction At my day job we decided to rewrite a Liferay portlet to React, it displays draws and results data from different numeric games (the client is a betting company slowly porting many of their games online). This particular portlet has been a pain in the ass to maintain, port new CRs, and was horrible performance wise, and that is because:\nThe code was inherited from another company and was written a long time ago with questionable structure/logic. There was never enough time to do a proper cleanup or rewrite. It tries to handle many different numeric games and in turn the code ends up being incomprehensible and bug prone. It has many expensive DOM operations. React Application Developing the React application standalone and outside of Liferay is a huge boost of productivity as you can take advantage of features like live reloading and your IDE’s debugger. This particular project is based on a monolithic architecture with no direct communication to the server from the client (ex websockets). It is tightly coupled with third party vendors and much of the information displayed comes from APIs that other teams use as well (ex mobile vendor). Some of the API calls happen at the backend at a predefined interval, this way the endpoint does not get bottled down from requests. That information is exposed to a window variable so that specific context can be accessible from different parts of the application.\nThe majority of data displayed in the portlet are fed in from the aforementioned window variable. On some user actions an endpoint is queried and the data displayed is updated. That is done with a useState hook that lets us add state to our components. The useState hook is particularly useful as React takes care of what to update in the UI - you only have to declaratively program the UI. You should definitely have a look at the docs as state management can get tricky without the right knowledge.\n// Declare the data state const [data, setData] = useState(window.contextContributor); const fetchData = (drawId) =\u003e { fetch(`${apiEndpoint}/draws/v3.0/5104/${drawId}`) .then(response =\u003e response.json()) .then(data =\u003e { // Update the state with the new data. React will take care of updating the UI setData(data); }) .catch((error) =\u003e console.debug(`[DRAWS \u0026\u0026 RESULTS DRAWS ERROR]: ${error}`)); }; // ... // Display some repeative nested field of data using Array.prototype.map() \u003cdiv className='balls-row'\u003e {data.winningNumbers.list.sort().map(number =\u003e { return (\u003cGameBall ballColor='blue-ball' number={number} key={number} /\u003e); })} \u003c/div\u003e // Add the click listener \u003cbutton className='btn draw-btn-left' onClick={() =\u003e handleDrawClick(data.drawId - 1)}\u003e \u003c/button\u003e Another helpful hook is useEffect which is used to synchronize the component with an external system. In our particular case we are going to use it to populate a html select with data from an API. This select displays the draw id’s for a given month. The same action is also triggered when the user selects a different month.\nWhen a month is changed three actions need to take place:\nFind the month in calendar format (1-12) using the monthTuple (see i18next down bellow for month tuple) and Array.prototype.findIndex(). For example, given September the variable monthInDateFormat is going to be 9. Set the new month in state. Correctly format the date for the endpoint, then fetch the new draw id’s and update the respective state. const fetchDraws = (monthInDateFormat) =\u003e { const formattedMonth = monthInDateFormat \u003e= 10 ? monthInDateFormat : `0${monthInDateFormat}`; const daysInMonth = new Date(year, monthInDateFormat, 0).getDate(); fetch(`${apiEndpoint}/draws/v3.0/5104/draw-date/${year}-${formattedMonth}-01/${year}-${formattedMonth}-${daysInMonth}/draw-id`) .then(response =\u003e response.json()) .then(data =\u003e setDraws(data)) .catch((error) =\u003e console.debug(`[DRAWS \u0026\u0026 RESULTS DRAW DATE ERROR]: ${error}`)); }; const changeMonth = (newMonth) =\u003e { const monthInDateFormat = monthTuple.findIndex(e =\u003e e === newMonth) + 1; setMonth(newMonth); // New draws need to be fetched every time the month changes fetchDraws(monthInDateFormat); }; useEffect(() =\u003e { changeMonth(monthTuple[thisMonth]); }, []); By passing an empty dependency array to the useEffect hook we are telling React that it uses no reactive values, and it can be run after the initial render. This way we won’t wait on an API call for a UI element that is not critical to appear on render time.\nAs far as localization goes I’ve chosen to use react-i18next for two reasons. Firstly I was already familiar with i18next from some personal projects, and secondly I didn’t want to be depended on Liferay’s inbuilt localization features because I was developing it as a standalone application. Setting it up is a breeze - I decided to install the base package and the browser-languagedetector. The configuration lives in a standalone file, as do the translations.\nimport i18n from 'i18next'; import {initReactI18next} from 'react-i18next'; import LanguageDetector from 'i18next-browser-languagedetector'; import el from './locales/el/translation.json' import en from './locales/en/translation.json' i18n .use(LanguageDetector) .use(initReactI18next) .init({ fallbackLng: 'el', resources: { el: {common: el}, en: {common: en} }, detection: { order: ['htmlTag'], convertDetectedLanguage: (lng) =\u003e lng === 'el-GR' ? 'el' : 'en' } }); export default i18n; It is now ready to be imported to your application, just remember to use the correct namespace like so:\nconst {t} = useTranslation('common'); // ... \u003ch2 className='title'\u003e{t('title')}\u003c/h2\u003e One neat option you can pass to the translation component is returnObjects, which returns an object. This way we can localize things like dates and avoid using a third party plugin like moment.js. We can take advantage of the javascript Date object and grab the date we want.\n{ \"monthTuple\": { \"0\": \"January\", \"1\": \"February\", \"2\": \"March\", \"3\": \"April\", \"4\": \"May\", \"5\": \"June\", \"6\": \"July\", \"7\": \"August\", \"8\": \"September\", \"9\": \"October\", \"10\": \"November\", \"11\": \"December\" } } const date = new Date(); const thisMonth = date.getMonth(); const monthTuple = Object.values(t('monthTuple', {returnObjects: true})); const [month, setMonth] = useState(monthTuple[thisMonth]); Porting to Liferay There are two ways to create a React widget:\nUse Blade to create a liferay-js module. Use Yeoman generator to create or adapt an existing React application. I found that creating a standalone React application with npx create-react-app and then porting it with yeoman proved useful, as I developed the module much faster outside of Liferay and only made some finishing touches once ported.\nDeploying was definitely not a breeze. We use Jenkins to build and deploy to a remote server but the module would fail and thus ruin the whole pipeline. I found no quick solution to that, so I resulted to rename the build scripts (so they wouldn’t get picked up by Gradle), build the module locally, and then deploy it to the remote server.\nConclusion This was the first React application and Liferay widget I had to develop. Despite some early hiccups, especially when trying to figure out how the Liferay widget works, I do believe that developer experience is boosted, performance is improved, and maintenance is made easier - in sort React 💕.\nSources Big props to my senior for guiding me because I would have probably ended up in an asylum trying to figure out the Liferay toolkit.\nhttps://github.com/0xAnakin/liferay-react-demo https://github.com/0xAnakin/Liferay74u46-react-demo https://help.liferay.com/hc/en-us/articles/360029028051-Developing-a-React-Application https://liferay.dev/en/blogs/-/blogs/liferay-react-portlets https://help.liferay.com/hc/en-us/articles/360028832872-Understanding-the-npmbundlerrc-s-Structure https://help.liferay.com/hc/en-us/articles/360028832892-How-the-Default-Preset-Configures-the-liferay-npm-bundler ","wordCount":"1135","inLanguage":"en","datePublished":"2023-09-25T00:00:00Z","dateModified":"2023-09-25T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://haris.razis.com/posts/building-liferay-widgets-with-react/"},"publisher":{"@type":"Organization","name":"xrazis | Haris Razis","logo":{"@type":"ImageObject","url":"https://haris.razis.com/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://haris.razis.com/ accesskey=h title="xrazis (Alt + H)">xrazis</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://haris.razis.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://haris.razis.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://haris.razis.com/>Home</a>&nbsp;»&nbsp;<a href=https://haris.razis.com/posts/>Posts</a></div><h1 class=post-title>Building Liferay widgets with React</h1><div class=post-meta><span title='2023-09-25 00:00:00 +0000 UTC'>25 September, 2023</span>&nbsp;·&nbsp;6 min&nbsp;|&nbsp;<a href=https://github.com/xrazis/haris.razis.com/tree/main/content/posts/building-liferay-widgets-with-react.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#react-application aria-label="React Application">React Application</a></li><li><a href=#porting-to-liferay aria-label="Porting to Liferay">Porting to Liferay</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li><li><a href=#sources aria-label=Sources>Sources</a></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>At my day job we decided to rewrite a Liferay portlet to React, it displays draws and results data from different
numeric games (the client is a betting company slowly porting many of their games online). This particular portlet has
been a pain in the ass to maintain, port new CRs, and was horrible performance wise, and that is because:</p><ol><li>The code was inherited from another company and was written a long time ago with questionable structure/logic. There
was never enough time to do a proper cleanup or rewrite.</li><li>It tries to handle many different numeric games and in turn the code ends up being incomprehensible and bug prone.</li><li>It has many expensive DOM operations.</li></ol><h1 id=react-application>React Application<a hidden class=anchor aria-hidden=true href=#react-application>#</a></h1><p>Developing the React application standalone and outside of Liferay is a huge boost of productivity as you can take
advantage of features like live reloading and your IDE&rsquo;s debugger. This particular project is based on a monolithic
architecture with no direct communication to the server from the client (ex websockets). It is tightly coupled with
third party vendors and much of the information displayed comes from APIs that other teams use as well (ex mobile
vendor). Some of the API calls happen at the backend at a predefined interval, this way the endpoint does not get
bottled down from requests. That information is exposed to a window variable so that specific context can be
accessible from different parts of the application.</p><p>The majority of data displayed in the portlet are fed in from the aforementioned window variable. On some user actions
an endpoint is queried and the data displayed is updated. That is done with a <code>useState</code> hook that lets us add state to
our components. The <code>useState</code> hook is particularly useful as React takes care of what to update in the UI - you only
have to declaratively program the UI. You should definitely have a look at the
<a href=https://react.dev/reference/react/useState>docs</a> as state management can get tricky without the right knowledge.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#75715e>// Declare the data state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>setData</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(window.<span style=color:#a6e22e>contextContributor</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fetchData</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>drawId</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>apiEndpoint</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/draws/v3.0/5104/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>drawId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>response</span> =&gt; <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>())
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>data</span> =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Update the state with the new data. React will take care of updating the UI
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>setData</span>(<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>error</span>) =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>`[DRAWS &amp;&amp; RESULTS DRAWS ERROR]: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>error</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>));
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Display some repeative nested field of data using Array.prototype.map()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;balls-row&#39;</span>&gt;
</span></span><span style=display:flex><span>    {<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>winningNumbers</span>.<span style=color:#a6e22e>list</span>.<span style=color:#a6e22e>sort</span>().<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>number</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (&lt;<span style=color:#f92672>GameBall</span> <span style=color:#a6e22e>ballColor</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;blue-ball&#39;</span>
</span></span><span style=display:flex><span>                          <span style=color:#a6e22e>number</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>number</span>}
</span></span><span style=display:flex><span>                          <span style=color:#a6e22e>key</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>number</span>}
</span></span><span style=display:flex><span>        /&gt;);
</span></span><span style=display:flex><span>    })}
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Add the click listener 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;btn draw-btn-left&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() =&gt; <span style=color:#a6e22e>handleDrawClick</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>drawId</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)}&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>button</span>&gt;
</span></span></code></pre></div><p>Another helpful hook is <code>useEffect</code> which is used to synchronize the component with an external system. In our
particular case we are going to use it to populate a html select with data from an API. This select displays the draw
id&rsquo;s for a given month. The same action is also triggered when the user selects a different month.</p><p><img loading=lazy src=/blog/20230929-01.png alt=img.png></p><p>When a month is changed three actions need to take place:</p><ol><li>Find the month in calendar format (1-12) using the monthTuple (see i18next down bellow for month tuple) and
<code>Array.prototype.findIndex()</code>. For example, given September the variable <code>monthInDateFormat</code> is going to be 9.</li><li>Set the new month in state.</li><li>Correctly format the date for the endpoint, then fetch the new draw id&rsquo;s and update the respective state.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fetchDraws</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>monthInDateFormat</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>formattedMonth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>monthInDateFormat</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>monthInDateFormat</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>`0</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>monthInDateFormat</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>daysInMonth</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(<span style=color:#a6e22e>year</span>, <span style=color:#a6e22e>monthInDateFormat</span>, <span style=color:#ae81ff>0</span>).<span style=color:#a6e22e>getDate</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>apiEndpoint</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/draws/v3.0/5104/draw-date/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>year</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>formattedMonth</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-01/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>year</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>formattedMonth</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>daysInMonth</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/draw-id`</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>response</span> =&gt; <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>())
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>data</span> =&gt; <span style=color:#a6e22e>setDraws</span>(<span style=color:#a6e22e>data</span>))
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>error</span>) =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>`[DRAWS &amp;&amp; RESULTS DRAW DATE ERROR]: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>error</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>));
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>changeMonth</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>newMonth</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>monthInDateFormat</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>monthTuple</span>.<span style=color:#a6e22e>findIndex</span>(<span style=color:#a6e22e>e</span> =&gt; <span style=color:#a6e22e>e</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>newMonth</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setMonth</span>(<span style=color:#a6e22e>newMonth</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// New draws need to be fetched every time the month changes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>fetchDraws</span>(<span style=color:#a6e22e>monthInDateFormat</span>);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>useEffect</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>changeMonth</span>(<span style=color:#a6e22e>monthTuple</span>[<span style=color:#a6e22e>thisMonth</span>]);
</span></span><span style=display:flex><span>}, []);
</span></span></code></pre></div><p>By passing an empty dependency array to the <code>useEffect</code> hook we are telling React that it uses no reactive values,
and it can be run after the initial render. This way we won&rsquo;t wait on an API call for a UI element that is not critical
to appear on render time.</p><p>As far as localization goes I&rsquo;ve chosen to use <a href=https://react.i18next.com/>react-i18next</a> for two reasons. Firstly I
was already familiar with i18next from some personal projects, and secondly I didn&rsquo;t want to be depended on Liferay&rsquo;s
inbuilt localization features because I was developing it as a standalone application. Setting it up is a breeze - I
decided to install the base package and the browser-languagedetector. The configuration lives in a standalone file, as
do the translations.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>i18n</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;i18next&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> {<span style=color:#a6e22e>initReactI18next</span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-i18next&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>LanguageDetector</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;i18next-browser-languagedetector&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>el</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./locales/el/translation.json&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>en</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./locales/en/translation.json&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>i18n</span>
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>LanguageDetector</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>initReactI18next</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>init</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fallbackLng</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;el&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resources</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>el</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>common</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>el</span>},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>en</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>common</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>en</span>}
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>detection</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>order</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;htmlTag&#39;</span>],
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>convertDetectedLanguage</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>lng</span>) =&gt; <span style=color:#a6e22e>lng</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;el-GR&#39;</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;el&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;en&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>i18n</span>;
</span></span></code></pre></div><p>It is now ready to be imported to your application, just remember to use the correct namespace like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>const</span> {<span style=color:#a6e22e>t</span>} <span style=color:#f92672>=</span> <span style=color:#a6e22e>useTranslation</span>(<span style=color:#e6db74>&#39;common&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>&lt;<span style=color:#f92672>h2</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;title&#39;</span>&gt;{<span style=color:#a6e22e>t</span>(<span style=color:#e6db74>&#39;title&#39;</span>)}&lt;/<span style=color:#f92672>h2</span>&gt;
</span></span></code></pre></div><p>One neat option you can pass to the translation component is <code>returnObjects</code>, which returns an object. This way we can
localize things like dates and avoid using a third party plugin like moment.js. We can take advantage of the javascript
Date object and grab the date we want.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;monthTuple&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;0&#34;</span>: <span style=color:#e6db74>&#34;January&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;1&#34;</span>: <span style=color:#e6db74>&#34;February&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;2&#34;</span>: <span style=color:#e6db74>&#34;March&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;3&#34;</span>: <span style=color:#e6db74>&#34;April&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;4&#34;</span>: <span style=color:#e6db74>&#34;May&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;5&#34;</span>: <span style=color:#e6db74>&#34;June&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;6&#34;</span>: <span style=color:#e6db74>&#34;July&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;7&#34;</span>: <span style=color:#e6db74>&#34;August&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;8&#34;</span>: <span style=color:#e6db74>&#34;September&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;9&#34;</span>: <span style=color:#e6db74>&#34;October&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;10&#34;</span>: <span style=color:#e6db74>&#34;November&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;11&#34;</span>: <span style=color:#e6db74>&#34;December&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>date</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>thisMonth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>date</span>.<span style=color:#a6e22e>getMonth</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>monthTuple</span> <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>values</span>(<span style=color:#a6e22e>t</span>(<span style=color:#e6db74>&#39;monthTuple&#39;</span>, {<span style=color:#a6e22e>returnObjects</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>}));
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>month</span>, <span style=color:#a6e22e>setMonth</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#a6e22e>monthTuple</span>[<span style=color:#a6e22e>thisMonth</span>]);
</span></span></code></pre></div><h1 id=porting-to-liferay>Porting to Liferay<a hidden class=anchor aria-hidden=true href=#porting-to-liferay>#</a></h1><p>There are two ways to create a React widget:</p><ul><li>Use Blade to create a liferay-js module.</li><li>Use Yeoman generator to create or adapt an existing React application.</li></ul><p>I found that creating a standalone React application with <code>npx create-react-app</code> and then porting it with <code>yeoman</code>
proved useful, as I developed the module much faster outside of Liferay and only made some finishing touches once
ported.</p><p>Deploying was definitely not a breeze. We use Jenkins to build and deploy to a remote server but the module would fail
and thus ruin the whole pipeline. I found no quick solution to that, so I resulted to rename the build scripts (so
they wouldn&rsquo;t get picked up by Gradle), build the module locally, and then deploy it to the remote server.</p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p>This was the first React application and Liferay widget I had to develop. Despite some early hiccups, especially when
trying to figure out how the Liferay widget works, I do believe that developer experience is boosted, performance is
improved, and maintenance is made easier - in sort <strong>React 💕</strong>.</p><h1 id=sources>Sources<a hidden class=anchor aria-hidden=true href=#sources>#</a></h1><p>Big props to my <a href=https://github.com/0xAnakin>senior</a> for guiding me because I would have probably ended up in an asylum
trying to figure out the Liferay toolkit.</p><ul><li><a href=https://github.com/0xAnakin/liferay-react-demo>https://github.com/0xAnakin/liferay-react-demo</a></li><li><a href=https://github.com/0xAnakin/Liferay74u46-react-demo>https://github.com/0xAnakin/Liferay74u46-react-demo</a></li><li><a href=https://help.liferay.com/hc/en-us/articles/360029028051-Developing-a-React-Application>https://help.liferay.com/hc/en-us/articles/360029028051-Developing-a-React-Application</a></li><li><a href=https://liferay.dev/en/blogs/-/blogs/liferay-react-portlets>https://liferay.dev/en/blogs/-/blogs/liferay-react-portlets</a></li><li><a href=https://help.liferay.com/hc/en-us/articles/360028832872-Understanding-the-npmbundlerrc-s-Structure>https://help.liferay.com/hc/en-us/articles/360028832872-Understanding-the-npmbundlerrc-s-Structure</a></li><li><a href=https://help.liferay.com/hc/en-us/articles/360028832892-How-the-Default-Preset-Configures-the-liferay-npm-bundler>https://help.liferay.com/hc/en-us/articles/360028832892-How-the-Default-Preset-Configures-the-liferay-npm-bundler</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://haris.razis.com/tags/react/>React</a></li><li><a href=https://haris.razis.com/tags/liferay/>Liferay</a></li></ul><nav class=paginav><a class=next href=https://haris.razis.com/posts/handling-emails-for-statically-generated-sites/><span class=title>Next »</span><br><span>Handling emails for statically generated sites</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://haris.razis.com/>xrazis | Haris Razis</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>