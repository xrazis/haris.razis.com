<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Debugging Unifi connections | xrazis · Haris Razis</title><meta name=keywords content="Networking,Unifi,Ubiquity"><meta name=description content="Accessing Unifi OS logs"><meta name=author content><link rel=canonical href=https://haris.razis.com/posts/debugging-unifi-connections/><link crossorigin=anonymous href=/assets/css/stylesheet.89ab531823353647679675617bf4d7fe92a229725f7e6cb869aa510bcd26a14c.css integrity="sha256-iatTGCM1NkdnlnVhe/TX/pKiKXJffmy4aapRC80moUw=" rel="preload stylesheet" as=style><link rel=icon href=https://haris.razis.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://haris.razis.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://haris.razis.com/favicon.png><link rel=apple-touch-icon href=https://haris.razis.com/apple-touch-icon.png><link rel=mask-icon href=https://haris.razis.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Debugging Unifi connections"><meta property="og:description" content="Accessing Unifi OS logs"><meta property="og:type" content="article"><meta property="og:url" content="https://haris.razis.com/posts/debugging-unifi-connections/"><meta property="og:image" content="https://haris.razis.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-08T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-08T00:00:00+00:00"><meta property="og:site_name" content="xrazis"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://haris.razis.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Debugging Unifi connections"><meta name=twitter:description content="Accessing Unifi OS logs"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://haris.razis.com/posts/"},{"@type":"ListItem","position":2,"name":"Debugging Unifi connections","item":"https://haris.razis.com/posts/debugging-unifi-connections/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Debugging Unifi connections","name":"Debugging Unifi connections","description":"Accessing Unifi OS logs","keywords":["Networking","Unifi","Ubiquity"],"articleBody":"Introduction Having SSH access to the server you are battling with is an invaluable tool - no matter how feature-rich the console may be. In the few past days, we (my father and I) faced connectivity issues on a corporate network where a specific client (a POS device) would not stay attached to the nearest access point but instead hop to an AP further away. That caused connectivity problems with slow/failed transactions. It finally proved to be a miss-configuration issue (as it always is) but had we had proper logging, we could have resolved the issue much sooner.\nUniFi OS The majority of hardware we use is from Ubiquity, with many different APs of various generations and a UDM PRO tying them all down. Unfortunately, Ubiquity’s documentation is sparse, so the information seen in this post was collected from blogs and community forums.\nThe first step is to enable SSH access to the UDM through the settings and set a password. Then SSH root@192.168.1.1 and enter the password you’ve just set. UniFi OS is based on Buildroot with some basic Linux commands (see those with help) and some UniFi-specific commands.\nFor some weird reason, UI decided we can’t have docs for the CLI so we have to do some digging ourselves. As mentioned on the community forum we can find the commands defined in the file syswrapper.sh. Edit that file with vi:\nvi `which syswrapper.sh` Then search for case $cmd in in the file. You can search in vi by hitting / and typing the search term. Don’t forget you can exit the file with :q!, which quits without saving. There is a thread on Reddit and a repository on GitHub that documents some of these commands. The following is a snippet from that file.\ncase $cmd in set-tmp-ip) exit_if_fake $cmd $* ;; set-adopt) # set-adopt mca-ctrl -t connect -s \"$1\" -k \"$2\" ;; set-channel) # set-channel # FIXME: dual radio for ath in `ls /proc/sys/net/*/%parent | cut -d '/' -f 5`; do iwconfig $ath channel $1 done ;; # ... Extracting logs We are going to extract log files from two locations:\n/var/log/messages - error logs. # Save the errors to a file cat /var/log/messages \u003e messages.log # Then transfer the file to your machine scp messages.log @: /data/unifi-core/logs - a directory that contains various UniFi OS logs. # Archive the whole dir tar -zcvf unifi-core-logs.tar.gz /data/unifi-core/logs/ # Then transfer the file to your machine scp messages.log @: From here on, you are going into a rabbit hole. May your soul find peace because reading these logs drove me crazy.\nAttributions UniFi CLI / SSH commands list All UniFi SSH Commands that You Want to Know How To SSH Into Your UniFi Dream Machine UniFi - How to View Log Files UniFi - Getting Support Files and Logs ","wordCount":"473","inLanguage":"en","datePublished":"2022-07-08T00:00:00Z","dateModified":"2022-07-08T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://haris.razis.com/posts/debugging-unifi-connections/"},"publisher":{"@type":"Organization","name":"xrazis · Haris Razis","logo":{"@type":"ImageObject","url":"https://haris.razis.com/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://haris.razis.com/ accesskey=h title="xrazis (Alt + H)">xrazis</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://haris.razis.com/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://haris.razis.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://haris.razis.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://haris.razis.com/>Home</a>&nbsp;»&nbsp;<a href=https://haris.razis.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Debugging Unifi connections</h1><div class=post-meta><span title='2022-07-08 00:00:00 +0000 UTC'>8 July, 2022</span>&nbsp;·&nbsp;3 min&nbsp;|&nbsp;<a href=https://github.com/xrazis/haris.razis.com/tree/main/content/posts/debugging-unifi-connections.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#unifi-os aria-label="UniFi OS">UniFi OS</a></li><li><a href=#extracting-logs aria-label="Extracting logs">Extracting logs</a><ul><ul><li><a href=#attributions aria-label=Attributions>Attributions</a></li></ul></ul></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>Having SSH access to the server you are battling with is an invaluable tool - no matter how feature-rich the console may be. In the few past days, we (my father and I) faced connectivity issues on a corporate network where a specific client (a POS device) would not stay attached to the nearest access point but instead hop to an AP further away. That caused connectivity problems with slow/failed transactions. It finally proved to be a miss-configuration issue (as it always is) but had we had proper logging, we could have resolved the issue much sooner.</p><h1 id=unifi-os>UniFi OS<a hidden class=anchor aria-hidden=true href=#unifi-os>#</a></h1><p>The majority of hardware we use is from Ubiquity, with many different APs of various generations and a UDM PRO tying them all down. Unfortunately, Ubiquity&rsquo;s documentation is sparse, so the information seen in this post was collected from blogs and community forums.</p><p>The first step is to enable SSH access to the UDM through the settings and set a password. Then SSH <code>root@192.168.1.1</code> and enter the password you&rsquo;ve just set. UniFi OS is based on <a href=https://github.com/buildroot/buildroot>Buildroot</a> with some basic Linux commands (see those with <code>help</code>) and some UniFi-specific commands.</p><p>For some weird reason, UI decided we can&rsquo;t have docs for the CLI so we have to do some digging ourselves. As mentioned on the community forum we can find the commands defined in the file <code>syswrapper.sh</code>. Edit that file with <code>vi</code>:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi <span style=color:#a5d6ff>`</span>which syswrapper.sh<span style=color:#a5d6ff>`</span>
</span></span></code></pre></div><p>Then search for <code>case $cmd in</code> in the file. You can search in vi by hitting <code>/</code> and typing the search term. Don&rsquo;t forget you can exit the file with <code>:q!</code>, which quits without saving. There is a <a href=https://www.reddit.com/r/Ubiquiti/comments/k2g8sk/some_useful_udmudmp_ssh_commands/>thread</a> on Reddit and a <a href=https://github.com/TobyAnscombe/udm-setup>repository</a> on GitHub that documents some of these commands. The following is a snippet from that file.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff7b72>case</span> <span style=color:#79c0ff>$cmd</span> in                                                                                                                    
</span></span><span style=display:flex><span>set-tmp-ip<span style=color:#ff7b72;font-weight:700>)</span>                                                                                                        
</span></span><span style=display:flex><span>        exit_if_fake <span style=color:#79c0ff>$cmd</span> <span style=color:#79c0ff>$*</span>                                                                                                    
</span></span><span style=display:flex><span>        ;;                                                                                                   
</span></span><span style=display:flex><span>set-adopt<span style=color:#ff7b72;font-weight:700>)</span>                                                                                                                      
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># set-adopt &lt;url&gt; &lt;authkey&gt;                                                                                             </span>
</span></span><span style=display:flex><span>        mca-ctrl -t connect -s <span style=color:#a5d6ff>&#34;</span><span style=color:#79c0ff>$1</span><span style=color:#a5d6ff>&#34;</span> -k <span style=color:#a5d6ff>&#34;</span><span style=color:#79c0ff>$2</span><span style=color:#a5d6ff>&#34;</span>                                                                                     
</span></span><span style=display:flex><span>        ;;                                                                                                           
</span></span><span style=display:flex><span>set-channel<span style=color:#ff7b72;font-weight:700>)</span>                                                                                                       
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># set-channel &lt;radio&gt; &lt;channel&gt;                                                                              </span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># FIXME: dual radio                                                                                                     </span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> ath in <span style=color:#a5d6ff>`</span>ls /proc/sys/net/*/%parent | cut -d <span style=color:#a5d6ff>&#39;/&#39;</span> -f 5<span style=color:#a5d6ff>`</span>; <span style=color:#ff7b72>do</span>                                                           
</span></span><span style=display:flex><span>                iwconfig <span style=color:#79c0ff>$ath</span> channel <span style=color:#79c0ff>$1</span>                                                                                        
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>done</span>                                                                                                                    
</span></span><span style=display:flex><span>        ;;                                                                                                                      
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ...                                                  </span>
</span></span></code></pre></div><h1 id=extracting-logs>Extracting logs<a hidden class=anchor aria-hidden=true href=#extracting-logs>#</a></h1><p>We are going to extract log files from two locations:</p><ol><li><code>/var/log/messages</code> - error logs.</li></ol><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Save the errors to a file</span>
</span></span><span style=display:flex><span>cat /var/log/messages &gt; messages.log
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Then transfer the file to your machine</span>
</span></span><span style=display:flex><span>scp messages.log &lt;user&gt;@&lt;device-name&gt;:&lt;path/to/transfer/to&gt;
</span></span></code></pre></div><ol start=2><li><code>/data/unifi-core/logs</code> - a directory that contains various UniFi OS logs.</li></ol><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Archive the whole dir </span>
</span></span><span style=display:flex><span>tar -zcvf unifi-core-logs.tar.gz /data/unifi-core/logs/
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Then transfer the file to your machine</span>
</span></span><span style=display:flex><span>scp messages.log &lt;user&gt;@&lt;device-name&gt;:&lt;path/to/transfer/to&gt;
</span></span></code></pre></div><p>From here on, you are going into a rabbit hole. May your soul find peace because reading these logs drove me crazy.</p><h3 id=attributions>Attributions<a hidden class=anchor aria-hidden=true href=#attributions>#</a></h3><ul><li><a href=https://community.ui.com/questions/Unifi-CLI-SSH-commands-list/e950d4c5-bf91-4f30-8d07-99103899328b#answer/03604df2-3dd1-4940-bffd-ddff72cae282>UniFi CLI / SSH commands list</a></li><li><a href=https://lazyadmin.nl/home-network/unifi-ssh-commands/>All UniFi SSH Commands that You Want to Know</a></li><li><a href=https://evanmccann.net/blog/2020/5/udm-ssh>How To SSH Into Your UniFi Dream Machine</a></li><li><a href=https://help.ui.com/hc/en-us/articles/204959834-UniFi-How-to-View-Log-Files>UniFi - How to View Log Files</a></li><li><a href=https://help.ui.com/hc/en-us/articles/360049956374-UniFi-UDM-Dream-Machine-Support-File-and-Logs>UniFi - Getting Support Files and Logs</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://haris.razis.com/tags/networking/>Networking</a></li><li><a href=https://haris.razis.com/tags/unifi/>Unifi</a></li><li><a href=https://haris.razis.com/tags/ubiquity/>Ubiquity</a></li></ul><nav class=paginav><a class=prev href=https://haris.razis.com/posts/form-endpoint/><span class=title>« Prev</span><br><span>Handling emails for statically generated sites</span></a>
<a class=next href=https://haris.razis.com/posts/resolved.conf/><span class=title>Next »</span><br><span>resolved.conf</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://haris.razis.com/>xrazis · Haris Razis</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>