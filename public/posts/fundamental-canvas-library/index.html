<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to create a snowfall effect in the browser | xrazis · Haris Razis</title><meta name=keywords content="Canvas"><meta name=description content="Building a basic Canvas library to animate falling objects in the background"><meta name=author content><link rel=canonical href=https://haris.razis.com/posts/fundamental-canvas-library/><link crossorigin=anonymous href=/assets/css/stylesheet.89ab531823353647679675617bf4d7fe92a229725f7e6cb869aa510bcd26a14c.css integrity="sha256-iatTGCM1NkdnlnVhe/TX/pKiKXJffmy4aapRC80moUw=" rel="preload stylesheet" as=style><link rel=icon href=https://haris.razis.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://haris.razis.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://haris.razis.com/favicon.png><link rel=apple-touch-icon href=https://haris.razis.com/apple-touch-icon.png><link rel=mask-icon href=https://haris.razis.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="How to create a snowfall effect in the browser"><meta property="og:description" content="Building a basic Canvas library to animate falling objects in the background"><meta property="og:type" content="article"><meta property="og:url" content="https://haris.razis.com/posts/fundamental-canvas-library/"><meta property="og:image" content="https://haris.razis.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-18T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-18T00:00:00+00:00"><meta property="og:site_name" content="xrazis"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://haris.razis.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="How to create a snowfall effect in the browser"><meta name=twitter:description content="Building a basic Canvas library to animate falling objects in the background"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://haris.razis.com/posts/"},{"@type":"ListItem","position":2,"name":"How to create a snowfall effect in the browser","item":"https://haris.razis.com/posts/fundamental-canvas-library/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to create a snowfall effect in the browser","name":"How to create a snowfall effect in the browser","description":"Building a basic Canvas library to animate falling objects in the background","keywords":["Canvas"],"articleBody":"Introduction The Canvas API is used to draw graphics with Javascript. It can be utilized to make browser games, animations, visualize data, and much more. We will create a really basic Canvas library that receives input from a configuration file and draws the falling items animation.\nParticle Class The Particle class represents a single falling object. It is initialized with the same config object as the Effect class, as it needs many of the same parameters for correctly placing a particle inside the viewport. The constructor is where the majority of the logic is placed. After randomly picking the position in the canvas, we set the size and speed with Math.random() so we get an effect of depth and different weight for each object.\nthis.x = Math.random() * this.config.canvasWidth; this.y = Math.random() * this.config.canvasHeight; this.size = Math.random() * 60 + 20; this.speed = Math.random() * 0.5 + 0.2; Then we need to randomly select an object from the sprite sheet and set the correct width/height. In order to reduce the initial config options required, we set the frame size for the X and Y axis by assuming the elements in the sprite are equally distanced on both axis.\nthis.frameX = Math.floor(Math.random() * this.config.spriteElementsX); this.frameY = Math.floor(Math.random() * this.config.spriteElementsY); this.frameSizeX = this.config.image.width / this.config.spriteElementsX; this.frameSizeY = this.config.image.height / this.config.spriteElementsY; The draw function is responsible for drawing the image on the canvas. The input parameters are best explained on MDN.\nfunction draw(ctx) { ctx.drawImage(this.config.image, this.frameX * this.frameSizeX, this.frameY * this.frameSizeY, this.frameSizeX, this.frameSizeY, this.x, this.y, this.size, this.size); } Lastly, the update function moves the particle down the Y axis, thus providing the snowfall animation. The speed config option determines the speed of the particle falling. It is important to reset the particle position to the top of the canvas once it has surpassed the canvas height - that way the animation will continue running indefinitely.\nfunction update() { this.y += this.speed; if (this.y - this.size \u003e this.config.canvasHeight) { this.y = 0 - this.size; } } Click for the complete Particle class class Particle { constructor(config) { this.config = config; this.x = Math.random() * this.config.canvasWidth; this.y = Math.random() * this.config.canvasHeight; this.size = Math.random() * 60 + 20; this.speed = Math.random() * 0.5 + 0.2; this.frameX = Math.floor(Math.random() * this.config.spriteElementsX); this.frameY = Math.floor(Math.random() * this.config.spriteElementsY); this.frameSizeX = this.config.image.width / this.config.spriteElementsX; this.frameSizeY = this.config.image.height / this.config.spriteElementsY; } get canvasWidth() { return this.config.canvasWidth; } set canvasWidth(width) { this.config.canvasWidth = width; } get canvasHeight() { return this.config.canvasHeight; } set canvasHeight(height) { this.config.canvasHeight = height; } update() { this.y += this.speed; if (this.y - this.size \u003e this.config.canvasHeight) { this.y = 0 - this.size; } } draw(ctx) { ctx.drawImage(this.config.image, this.frameX * this.frameSizeX, this.frameY * this.frameSizeY, this.frameSizeX, this.frameSizeY, this.x, this.y, this.size, this.size); } } Effect Class The Effect class is used to create and manipulate Particle classes. In the constructor the config object is set, then the sprite is loaded, and only when loaded is the rest of the code allowed to run. If you try to execute any code that needs the image prior to that you are not guaranteed that the image will be loaded.\nthis.config = config; this.image = new Image(); this.image.onload = () =\u003e { this.config.image = this.image; this.canvas = document.getElementById(this.config.canvas); this.ctx = this.canvas.getContext('2d'); this.particlesArray = []; this.setCanvasDimensions(); this.initParticlesArray(); this.handleParticles(); this.startAnimation(); this.registerListeners(); } this.image.src = this.config.spriteUrl; Once the image is loaded, the canvas is created, and a drawing context is set - a 2d rendering context in our case. Then we set the window dimensions both in the canvas and the config object.\nfunction setCanvasDimensions() { this.canvas.width = window.innerWidth; this.canvas.height = window.innerHeight; this.config.canvasWidth = window.innerWidth; this.config.canvasHeight = window.innerHeight; } This is done for a very specific reason. The Particle needs to know the canvas width and height. In this case it is the window width and height, but in other cases it may as well be different. This way we can choose the Particle position randomly somewhere inside that canvas. Keep in mind that we also need to accommodate for any resize events, an expensive but necessary operation.\nfunction setParticleDimensions() { this.particlesArray.forEach(particle =\u003e { particle.canvasWidth = this.config.canvasWidth; particle.canvasHeight = this.config.canvasHeight; }); } function onResize() { this.setCanvasDimensions(); this.setParticleDimensions(); } function registerListeners() { window.addEventListener('resize', () =\u003e this.onResize()); } Then, the Particles are created, and the animation is started. I have used the requestAnimationFrame and not a setInterval. That is because setting an interval is not a reliable way to animate things - in the case the function provided takes longer than 16ms (1/60 sec - 60FPS) that will cause blocking and result in dropped frames. The requestAnimationFrame invokes the callback function at each repaint. This is typically every 1/60th of a second, thus providing the wanted frame rate of 60FPS.\nClick for the complete Effect class class Effect { constructor(config) { this.config = config; this.image = new Image(); this.image.onload = () =\u003e { this.config.image = this.image; this.canvas = document.getElementById(this.config.canvas); this.ctx = this.canvas.getContext('2d'); this.particlesArray = []; this.setCanvasDimensions(); this.initParticlesArray(); this.handleParticles(); this.startAnimation(); this.registerListeners(); } this.image.src = this.config.spriteUrl; } setCanvasDimensions() { this.canvas.width = window.innerWidth; this.canvas.height = window.innerHeight; this.config.canvasWidth = window.innerWidth; this.config.canvasHeight = window.innerHeight; } setParticleDimensions() { this.particlesArray.forEach(particle =\u003e { particle.canvasWidth = this.config.canvasWidth; particle.canvasHeight = this.config.canvasHeight; }); } initParticlesArray() { for (let i = 0; i \u003c this.config.particlesCount; i++) { this.particlesArray.push(new Particle(this.config)); } } clearRect() { this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); } handleParticles() { this.clearRect(); this.particlesArray.forEach(particle =\u003e { particle.update(); particle.draw(this.ctx); }); } onResize() { this.setCanvasDimensions(); this.setParticleDimensions(); } startAnimation() { const render = () =\u003e { this.handleParticles(); requestAnimationFrame(render); } render(); } registerListeners() { window.addEventListener('resize', (e) =\u003e this.onResize()); } } Initialization of the effect The following script is the initialization code for the Effect class. The input is a config object with the following options:\ncanvas: The id of the Canvas HTML element. spriteUrl: The image (in the form of a sprite) to be used for the falling objects. particlesCount: The items count to be created - they are randomly selected from the sprite. spriteElementsX: The images in the X axis of the sprite sheet. spriteElementsY: The images in the Y axis of the sprite sheet. const config = { canvas: 'canvas-animation', particlesCount: 10, spriteUrl: \"https://haris.razis.com/blog/20240114-cat.png\", spriteElementsX: 5, spriteElementsY: 2, }; new Effect(config); You can observe the code running in the following CodePen, voilà!\nSee the Pen by Haris Razis (@xrazis) on CodePen. Sources MDN Web Docs - Canvas API ","wordCount":"1043","inLanguage":"en","datePublished":"2024-01-18T00:00:00Z","dateModified":"2024-01-18T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://haris.razis.com/posts/fundamental-canvas-library/"},"publisher":{"@type":"Organization","name":"xrazis · Haris Razis","logo":{"@type":"ImageObject","url":"https://haris.razis.com/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://haris.razis.com/ accesskey=h title="xrazis (Alt + H)">xrazis</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://haris.razis.com/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://haris.razis.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://haris.razis.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://haris.razis.com/>Home</a>&nbsp;»&nbsp;<a href=https://haris.razis.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">How to create a snowfall effect in the browser</h1><div class=post-meta><span title='2024-01-18 00:00:00 +0000 UTC'>18 January, 2024</span>&nbsp;·&nbsp;5 min&nbsp;|&nbsp;<a href=https://github.com/xrazis/haris.razis.com/tree/main/content/posts/fundamental-canvas-library.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#particle-class aria-label="Particle Class">Particle Class</a></li><li><a href=#effect-class aria-label="Effect Class">Effect Class</a></li><li><a href=#initialization-of-the-effect aria-label="Initialization of the effect">Initialization of the effect</a></li><li><a href=#sources aria-label=Sources>Sources</a></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>The Canvas API is used to draw graphics with Javascript. It can be utilized to make browser games, animations, visualize
data, and much more. We will create a really basic Canvas library that receives input from a configuration file and
draws the falling items animation.</p><h1 id=particle-class>Particle Class<a hidden class=anchor aria-hidden=true href=#particle-class>#</a></h1><p>The <code>Particle</code> class represents a single falling object. It is initialized with the same config object as the <code>Effect</code>
class, as it needs many of the same parameters for correctly placing a particle inside the viewport. The constructor
is where the majority of the logic is placed. After randomly picking the position in the canvas, we set the size and
speed with <code>Math.random()</code> so we get an effect of depth and different weight for each object.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>this</span>.x <span style=color:#ff7b72;font-weight:700>=</span> Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.config.canvasWidth;
</span></span><span style=display:flex><span><span style=color:#ff7b72>this</span>.y <span style=color:#ff7b72;font-weight:700>=</span> Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.config.canvasHeight;
</span></span><span style=display:flex><span><span style=color:#ff7b72>this</span>.size <span style=color:#ff7b72;font-weight:700>=</span> Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>20</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>this</span>.speed <span style=color:#ff7b72;font-weight:700>=</span> Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>0.5</span> <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>0.2</span>;
</span></span></code></pre></div><p>Then we need to randomly select an object from the sprite sheet and set the correct width/height. In order to reduce the
initial config options required, we set the frame size for the X and Y axis by assuming the elements in the sprite are
equally distanced on both axis.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>this</span>.frameX <span style=color:#ff7b72;font-weight:700>=</span> Math.floor(Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.config.spriteElementsX);
</span></span><span style=display:flex><span><span style=color:#ff7b72>this</span>.frameY <span style=color:#ff7b72;font-weight:700>=</span> Math.floor(Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.config.spriteElementsY);
</span></span><span style=display:flex><span><span style=color:#ff7b72>this</span>.frameSizeX <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.config.image.width <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#ff7b72>this</span>.config.spriteElementsX;
</span></span><span style=display:flex><span><span style=color:#ff7b72>this</span>.frameSizeY <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.config.image.height <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#ff7b72>this</span>.config.spriteElementsY;
</span></span></code></pre></div><p>The draw function is responsible for drawing the image on the canvas. The input parameters are best explained
on <a href=https://developer.mozilla.org/en-US/docs/web/api/canvasrenderingcontext2d/drawimage>MDN</a>.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>function</span> draw(ctx) {
</span></span><span style=display:flex><span>  ctx.drawImage(<span style=color:#ff7b72>this</span>.config.image, <span style=color:#ff7b72>this</span>.frameX <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.frameSizeX, <span style=color:#ff7b72>this</span>.frameY <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.frameSizeY,
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.frameSizeX, <span style=color:#ff7b72>this</span>.frameSizeY, <span style=color:#ff7b72>this</span>.x, <span style=color:#ff7b72>this</span>.y, <span style=color:#ff7b72>this</span>.size, <span style=color:#ff7b72>this</span>.size);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Lastly, the update function moves the particle down the Y axis, thus providing the snowfall animation. The speed config
option determines the speed of the particle falling. It is important to reset the particle position to the top of the
canvas once it has surpassed the canvas height - that way the animation will continue running indefinitely.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>function</span> update() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.y <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#ff7b72>this</span>.speed;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.y <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#ff7b72>this</span>.size <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#ff7b72>this</span>.config.canvasHeight) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.y <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span> <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#ff7b72>this</span>.size;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><details><summary>Click for the complete <code>Particle</code> class</summary><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>class</span> Particle {
</span></span><span style=display:flex><span>  constructor(config) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.config <span style=color:#ff7b72;font-weight:700>=</span> config;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.x <span style=color:#ff7b72;font-weight:700>=</span> Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.config.canvasWidth;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.y <span style=color:#ff7b72;font-weight:700>=</span> Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.config.canvasHeight;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.size <span style=color:#ff7b72;font-weight:700>=</span> Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>20</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.speed <span style=color:#ff7b72;font-weight:700>=</span> Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>0.5</span> <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>0.2</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.frameX <span style=color:#ff7b72;font-weight:700>=</span> Math.floor(Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.config.spriteElementsX);
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.frameY <span style=color:#ff7b72;font-weight:700>=</span> Math.floor(Math.random() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.config.spriteElementsY);
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.frameSizeX <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.config.image.width <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#ff7b72>this</span>.config.spriteElementsX;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.frameSizeY <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.config.image.height <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#ff7b72>this</span>.config.spriteElementsY;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  get canvasWidth() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.config.canvasWidth;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  set canvasWidth(width) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.config.canvasWidth <span style=color:#ff7b72;font-weight:700>=</span> width;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  get canvasHeight() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.config.canvasHeight;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  set canvasHeight(height) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.config.canvasHeight <span style=color:#ff7b72;font-weight:700>=</span> height;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  update() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.y <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#ff7b72>this</span>.speed;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.y <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#ff7b72>this</span>.size <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#ff7b72>this</span>.config.canvasHeight) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.y <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span> <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#ff7b72>this</span>.size;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  draw(ctx) {
</span></span><span style=display:flex><span>    ctx.drawImage(<span style=color:#ff7b72>this</span>.config.image, <span style=color:#ff7b72>this</span>.frameX <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.frameSizeX, <span style=color:#ff7b72>this</span>.frameY <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#ff7b72>this</span>.frameSizeY,
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.frameSizeX, <span style=color:#ff7b72>this</span>.frameSizeY, <span style=color:#ff7b72>this</span>.x, <span style=color:#ff7b72>this</span>.y, <span style=color:#ff7b72>this</span>.size, <span style=color:#ff7b72>this</span>.size);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><h1 id=effect-class>Effect Class<a hidden class=anchor aria-hidden=true href=#effect-class>#</a></h1><p>The <code>Effect</code> class is used to create and manipulate <code>Particle</code> classes. In the constructor the config object is set,
then the sprite is loaded, and only when loaded is the rest of the code allowed to run. If you try to execute
any code that needs the image prior to that you are not guaranteed that the image will be loaded.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>this</span>.config <span style=color:#ff7b72;font-weight:700>=</span> config;
</span></span><span style=display:flex><span><span style=color:#ff7b72>this</span>.image <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Image();
</span></span><span style=display:flex><span><span style=color:#ff7b72>this</span>.image.onload <span style=color:#ff7b72;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.config.image <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.image;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.canvas <span style=color:#ff7b72;font-weight:700>=</span> document.getElementById(<span style=color:#ff7b72>this</span>.config.canvas);
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.ctx <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.canvas.getContext(<span style=color:#a5d6ff>&#39;2d&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.particlesArray <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.setCanvasDimensions();
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.initParticlesArray();
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.handleParticles();
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.startAnimation();
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.registerListeners();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff7b72>this</span>.image.src <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.config.spriteUrl;
</span></span></code></pre></div><p>Once the image is loaded, the canvas is created, and a drawing context is set - a 2d rendering context in our case. Then
we set the window dimensions both in the canvas and the config object.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>function</span> setCanvasDimensions() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.canvas.width <span style=color:#ff7b72;font-weight:700>=</span> window.innerWidth;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.canvas.height <span style=color:#ff7b72;font-weight:700>=</span> window.innerHeight;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.config.canvasWidth <span style=color:#ff7b72;font-weight:700>=</span> window.innerWidth;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.config.canvasHeight <span style=color:#ff7b72;font-weight:700>=</span> window.innerHeight;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is done for a very specific reason. The <code>Particle</code> needs to know the canvas width and height. In this case it is
the window width and height, but in other cases it may as well be different. This way we can choose the <code>Particle</code>
position randomly somewhere inside that canvas. Keep in mind that we also need to accommodate for any resize events, an
expensive but necessary operation.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>function</span> setParticleDimensions() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.particlesArray.forEach(particle =&gt; {
</span></span><span style=display:flex><span>    particle.canvasWidth <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.config.canvasWidth;
</span></span><span style=display:flex><span>    particle.canvasHeight <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.config.canvasHeight;
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>function</span> onResize() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.setCanvasDimensions();
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>this</span>.setParticleDimensions();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>function</span> registerListeners() {
</span></span><span style=display:flex><span>  window.addEventListener(<span style=color:#a5d6ff>&#39;resize&#39;</span>, () =&gt; <span style=color:#ff7b72>this</span>.onResize());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then, the <code>Particles</code> are created, and the animation is started. I have used the <code>requestAnimationFrame</code> and not
a <code>setInterval</code>. That is because setting an interval is not a reliable way to animate things - in the case the function
provided takes longer than 16ms (1/60 sec - 60FPS) that will cause blocking and result in dropped frames.
The <code>requestAnimationFrame</code> invokes the callback function at each repaint. This is typically every 1/60th of a second,
thus providing the wanted frame rate of 60FPS.</p><details><summary>Click for the complete <code>Effect</code> class</summary><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>class</span> Effect {
</span></span><span style=display:flex><span>  constructor(config) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.config <span style=color:#ff7b72;font-weight:700>=</span> config;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.image <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Image();
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.image.onload <span style=color:#ff7b72;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.config.image <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.image;
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.canvas <span style=color:#ff7b72;font-weight:700>=</span> document.getElementById(<span style=color:#ff7b72>this</span>.config.canvas);
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.ctx <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.canvas.getContext(<span style=color:#a5d6ff>&#39;2d&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.particlesArray <span style=color:#ff7b72;font-weight:700>=</span> [];
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.setCanvasDimensions();
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.initParticlesArray();
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.handleParticles();
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.startAnimation();
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.registerListeners();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.image.src <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.config.spriteUrl;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  setCanvasDimensions() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.canvas.width <span style=color:#ff7b72;font-weight:700>=</span> window.innerWidth;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.canvas.height <span style=color:#ff7b72;font-weight:700>=</span> window.innerHeight;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.config.canvasWidth <span style=color:#ff7b72;font-weight:700>=</span> window.innerWidth;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.config.canvasHeight <span style=color:#ff7b72;font-weight:700>=</span> window.innerHeight;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  setParticleDimensions() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.particlesArray.forEach(particle =&gt; {
</span></span><span style=display:flex><span>      particle.canvasWidth <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.config.canvasWidth;
</span></span><span style=display:flex><span>      particle.canvasHeight <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.config.canvasHeight;
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  initParticlesArray() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>let</span> i <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>; i <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#ff7b72>this</span>.config.particlesCount; i<span style=color:#ff7b72;font-weight:700>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.particlesArray.push(<span style=color:#ff7b72>new</span> Particle(<span style=color:#ff7b72>this</span>.config));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  clearRect() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.ctx.clearRect(<span style=color:#a5d6ff>0</span>, <span style=color:#a5d6ff>0</span>, <span style=color:#ff7b72>this</span>.canvas.width, <span style=color:#ff7b72>this</span>.canvas.height);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handleParticles() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.clearRect();
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.particlesArray.forEach(particle =&gt; {
</span></span><span style=display:flex><span>      particle.update();
</span></span><span style=display:flex><span>      particle.draw(<span style=color:#ff7b72>this</span>.ctx);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  onResize() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.setCanvasDimensions();
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.setParticleDimensions();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  startAnimation() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> render <span style=color:#ff7b72;font-weight:700>=</span> () =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.handleParticles();
</span></span><span style=display:flex><span>      requestAnimationFrame(render);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    render();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  registerListeners() {
</span></span><span style=display:flex><span>    window.addEventListener(<span style=color:#a5d6ff>&#39;resize&#39;</span>, (e) =&gt; <span style=color:#ff7b72>this</span>.onResize());
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><h1 id=initialization-of-the-effect>Initialization of the effect<a hidden class=anchor aria-hidden=true href=#initialization-of-the-effect>#</a></h1><p>The following script is the initialization code for the Effect class. The input is a
config object with the following options:</p><ul><li><code>canvas</code>: The id of the Canvas HTML element.</li><li><code>spriteUrl</code>: The image (in the form of a sprite) to be used for the falling objects.</li><li><code>particlesCount</code>: The items count to be created - they are randomly selected from the sprite.</li><li><code>spriteElementsX</code>: The images in the X axis of the sprite sheet.</li><li><code>spriteElementsY</code>: The images in the Y axis of the sprite sheet.</li></ul><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>const</span> config <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  canvas<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;canvas-animation&#39;</span>,
</span></span><span style=display:flex><span>  particlesCount<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>10</span>,
</span></span><span style=display:flex><span>  spriteUrl<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;https://haris.razis.com/blog/20240114-cat.png&#34;</span>,
</span></span><span style=display:flex><span>  spriteElementsX<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>5</span>,
</span></span><span style=display:flex><span>  spriteElementsY<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>2</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>new</span> Effect(config);
</span></span></code></pre></div><p>You can observe the code running in the following CodePen, voilà!</p><p class=codepen data-height=500 data-theme-id=dark data-default-tab=result data-slug-hash=oNVBgMP data-user=xrazis style="height:300px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;border:2px solid;margin:1em 0;padding:1em"><span>See the <a href=https://codepen.io/xrazis/pen/oNVBgMP>Pen</a> by Haris Razis (<a href=https://codepen.io/xrazis>@xrazis</a>)
on <a href=https://codepen.io>CodePen</a>.</span></p><script async src=https://cpwebassets.codepen.io/assets/embed/ei.js></script><h1 id=sources>Sources<a hidden class=anchor aria-hidden=true href=#sources>#</a></h1><ul><li><a href=https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API>MDN Web Docs - Canvas API</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://haris.razis.com/tags/canvas/>Canvas</a></li></ul><nav class=paginav><a class=next href=https://haris.razis.com/posts/dotfiles/><span class=title>Next »</span><br><span>Dotfiles</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://haris.razis.com/>xrazis · Haris Razis</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>