<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Handling emails for statically generated sites | xrazis | Haris Razis</title><meta name=keywords content="Hugo,Express.js,Node.js"><meta name=description content="Minimal Express.js server to post emails from SSGs"><meta name=author content><link rel=canonical href=https://haris.razis.com/posts/handling-emails-for-statically-generated-sites/><link crossorigin=anonymous href=/assets/css/stylesheet.fd79fc7085a4ef82f257aa90ca5ce4e4cbecd45f70cf71a7e373836d2d387480.css integrity="sha256-/Xn8cIWk74LyV6qQylzk5Mvs1F9wz3Gn43ODbS04dIA=" rel="preload stylesheet" as=style><link rel=icon href=https://haris.razis.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://haris.razis.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://haris.razis.com/favicon.png><link rel=apple-touch-icon href=https://haris.razis.com/apple-touch-icon.png><link rel=mask-icon href=https://haris.razis.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Handling emails for statically generated sites"><meta property="og:description" content="Minimal Express.js server to post emails from SSGs"><meta property="og:type" content="article"><meta property="og:url" content="https://haris.razis.com/posts/handling-emails-for-statically-generated-sites/"><meta property="og:image" content="https://haris.razis.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-08T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-08T00:00:00+00:00"><meta property="og:site_name" content="xrazis"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://haris.razis.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Handling emails for statically generated sites"><meta name=twitter:description content="Minimal Express.js server to post emails from SSGs"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://haris.razis.com/posts/"},{"@type":"ListItem","position":2,"name":"Handling emails for statically generated sites","item":"https://haris.razis.com/posts/handling-emails-for-statically-generated-sites/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Handling emails for statically generated sites","name":"Handling emails for statically generated sites","description":"Minimal Express.js server to post emails from SSGs","keywords":["Hugo","Express.js","Node.js"],"articleBody":"Introduction Statically generated sites are fast and flexible but don’t have the ability to send contact us emails due to the lack of a backend. A simple solution would be using a service like Airform, Mailgun, or Formspree, but where’s the fun in that? Instead, we can build a simple Express.js API that will handle POST requests from a form and will in turn forward that email to a mailbox.\nFrontend First of all make sure you have a working form. Create the fields you need, give a descriptive id to all the elements, and omit any action or method attributes.\n\u003cform id=\"contactForm\"\u003e \u003cdiv class=\"mb-6\"\u003e \u003clabel class=\"form-label\" for=\"name\"\u003e Όνομα \u003cspan class=\"text-red-500\"\u003e*\u003c/span\u003e \u003c/label\u003e \u003cinput class=\"form-input\" id=\"name\" name=\"name\" placeholder=\"Frida Kahlo\" type=\"text\"/\u003e \u003c/div\u003e ... \u003c/form\u003e Then for the scripting part we are going to set an Event Listener on the form and listen for any submit events. Make sure to include mode: \"cors\" as we will be filtering request on the server side based on the origin of the request.\nconst endpoint = '{{ site.Params.contact_form_action }}'; const contactForm = document.getElementById('contactForm'); contactForm.addEventListener('submit', event =\u003e { event.preventDefault(); const data = new FormData(contactForm); data.set('serverEmail', 'info@antamacollective.gr'); fetch(endpoint, { method: \"POST\", mode: \"cors\", body: data, }).then(response =\u003e { if (response.status === 200) { document.getElementById('successful-email').classList.remove('hidden'); } else { document.getElementById('failed-email').classList.remove('hidden'); } document.getElementById('submitterButton').setAttribute('disabled', ''); }); }); Backend The backend is a simple Node.js server with Express.js. One integral part is CORS, which only allows specific domains to access the POST path. In sort, CORS is an HTTP-header based mechanism that allows a server to indicate any origins other than its own from which a browser should permit loading resources. This is simply done in Express with the cors middleware. The configuration is simple enough, as seen in the code snippet bellow, you just have to define the allowed origins. The default configuration is adequate for most cases.\nconst corsOptions = { origin: ['https://antamacollective.gr'], } app.get('/send-email', cors(corsOptions), (req, res) =\u003e { res.status(200).send('This route is only visible from CORS allowed origin.'); }); The /send-email route is responsible for posting the email. There are two middleware, multer which decodes multipart/form-data and cors which was explained in the section above. Within the function the fields are validated against a Joi schema and then the email is sent with Nodemailer.\napp.post('/send-email', cors(corsOptions), multer().none(), async (req, res) =\u003e { try { const {name, email, message, serverEmail} = req.body; const host = req.hostname; //Validate against our schema await emailSchema.validateAsync({name, email, message}); const mail = { from: email_user, replyTo: email, to: serverEmail, subject: `Email from ${host} - inquiry from: ${name}`, text: message }; transporter.sendMail(mail, (err, info) =\u003e { if (err) { res.sendStatus(500); return; } res.sendStatus(200); }); } catch (err) { res.sendStatus(400); } }); Repositories https://github.com/xrazis/form-endpoint/ https://github.com/xrazis/antamacollective.gr ","wordCount":"447","inLanguage":"en","datePublished":"2023-09-08T00:00:00Z","dateModified":"2023-09-08T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://haris.razis.com/posts/handling-emails-for-statically-generated-sites/"},"publisher":{"@type":"Organization","name":"xrazis | Haris Razis","logo":{"@type":"ImageObject","url":"https://haris.razis.com/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://haris.razis.com/ accesskey=h title="xrazis (Alt + H)">xrazis</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://haris.razis.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://haris.razis.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://haris.razis.com/>Home</a>&nbsp;»&nbsp;<a href=https://haris.razis.com/posts/>Posts</a></div><h1 class=post-title>Handling emails for statically generated sites</h1><div class=post-meta><span title='2023-09-08 00:00:00 +0000 UTC'>8 September, 2023</span>&nbsp;·&nbsp;3 min&nbsp;|&nbsp;<a href=https://github.com/xrazis/haris.razis.com/tree/main/content/posts/handling-emails-for-statically-generated-sites.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#frontend aria-label=Frontend>Frontend</a></li><li><a href=#backend aria-label=Backend>Backend</a></li><li><a href=#repositories aria-label=Repositories>Repositories</a></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>Statically generated sites are fast and flexible but don&rsquo;t have the ability to send <em><strong>contact us</strong></em> emails due to the
lack of a backend. A simple solution would be using a service like Airform, Mailgun, or Formspree, but where&rsquo;s the fun
in that? Instead, we can build a simple Express.js API that will handle POST requests from a form and will in turn
forward that email to a mailbox.</p><h1 id=frontend>Frontend<a hidden class=anchor aria-hidden=true href=#frontend>#</a></h1><p>First of all make sure you have a working form. Create the fields you need, give a descriptive id to all the
elements, and omit any <code>action</code> or <code>method</code> attributes.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#7ee787>form</span> id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;contactForm&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>div</span> class<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;mb-6&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#7ee787>label</span> class<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;form-label&#34;</span> for<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;name&#34;</span>&gt;
</span></span><span style=display:flex><span>            Όνομα &lt;<span style=color:#7ee787>span</span> class<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;text-red-500&#34;</span>&gt;*&lt;/<span style=color:#7ee787>span</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#7ee787>label</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#7ee787>input</span>
</span></span><span style=display:flex><span>                class<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;form-input&#34;</span>
</span></span><span style=display:flex><span>                id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;name&#34;</span>
</span></span><span style=display:flex><span>                name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;name&#34;</span>
</span></span><span style=display:flex><span>                placeholder<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Frida Kahlo&#34;</span>
</span></span><span style=display:flex><span>                type<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;text&#34;</span>/&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>form</span>&gt;
</span></span></code></pre></div><p>Then for the scripting part we are going to set an Event Listener on the form and listen for any submit events. Make
sure to include <code>mode: "cors"</code> as we will be filtering request on the server side based on the origin of the request.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>const</span> endpoint <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;{{ site.Params.contact_form_action }}&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> contactForm <span style=color:#ff7b72;font-weight:700>=</span> document.getElementById(<span style=color:#a5d6ff>&#39;contactForm&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>contactForm.addEventListener(<span style=color:#a5d6ff>&#39;submit&#39;</span>, event =&gt; {
</span></span><span style=display:flex><span>    event.preventDefault();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> data <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> FormData(contactForm);
</span></span><span style=display:flex><span>    data.set(<span style=color:#a5d6ff>&#39;serverEmail&#39;</span>, <span style=color:#a5d6ff>&#39;info@antamacollective.gr&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fetch(endpoint, {
</span></span><span style=display:flex><span>        method<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>        mode<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;cors&#34;</span>,
</span></span><span style=display:flex><span>        body<span style=color:#ff7b72;font-weight:700>:</span> data,
</span></span><span style=display:flex><span>    }).then(response =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (response.status <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>200</span>) {
</span></span><span style=display:flex><span>            document.getElementById(<span style=color:#a5d6ff>&#39;successful-email&#39;</span>).classList.remove(<span style=color:#a5d6ff>&#39;hidden&#39;</span>);
</span></span><span style=display:flex><span>        } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>            document.getElementById(<span style=color:#a5d6ff>&#39;failed-email&#39;</span>).classList.remove(<span style=color:#a5d6ff>&#39;hidden&#39;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        document.getElementById(<span style=color:#a5d6ff>&#39;submitterButton&#39;</span>).setAttribute(<span style=color:#a5d6ff>&#39;disabled&#39;</span>, <span style=color:#a5d6ff>&#39;&#39;</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h1 id=backend>Backend<a hidden class=anchor aria-hidden=true href=#backend>#</a></h1><p>The backend is a simple Node.js server with Express.js. One integral part is CORS, which only allows
specific domains to access the POST path. In sort, <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS>CORS is an HTTP-header based mechanism that allows a server to
indicate any origins other than its own from which a browser should permit loading resources</a>.
This is simply done in Express with the cors middleware. The configuration is simple enough, as seen in the code snippet
bellow, you just have to define the allowed origins. The default configuration is adequate for most cases.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff7b72>const</span> corsOptions <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>    origin<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;https://antamacollective.gr&#39;</span>],
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.get(<span style=color:#a5d6ff>&#39;/send-email&#39;</span>, cors(corsOptions), (req, res) =&gt; {
</span></span><span style=display:flex><span>    res.status(<span style=color:#a5d6ff>200</span>).send(<span style=color:#a5d6ff>&#39;This route is only visible from CORS allowed origin.&#39;</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>The <code>/send-email</code> route is responsible for posting the email. There are two middleware, multer which decodes
<code>multipart/form-data</code> and cors which was explained in the section above. Within the function the fields are validated
against a Joi schema and then the email is sent with Nodemailer.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>app.post(<span style=color:#a5d6ff>&#39;/send-email&#39;</span>, cors(corsOptions), multer().none(), <span style=color:#ff7b72>async</span> (req, res) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> {name, email, message, serverEmail} <span style=color:#ff7b72;font-weight:700>=</span> req.body;
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> host <span style=color:#ff7b72;font-weight:700>=</span> req.hostname;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>//Validate against our schema
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#ff7b72>await</span> emailSchema.validateAsync({name, email, message});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> mail <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            from<span style=color:#ff7b72;font-weight:700>:</span> email_user,
</span></span><span style=display:flex><span>            replyTo<span style=color:#ff7b72;font-weight:700>:</span> email,
</span></span><span style=display:flex><span>            to<span style=color:#ff7b72;font-weight:700>:</span> serverEmail,
</span></span><span style=display:flex><span>            subject<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>`Email from </span><span style=color:#a5d6ff>${</span>host<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> - inquiry from: </span><span style=color:#a5d6ff>${</span>name<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>,
</span></span><span style=display:flex><span>            text<span style=color:#ff7b72;font-weight:700>:</span> message
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        transporter.sendMail(mail, (err, info) =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> (err) {
</span></span><span style=display:flex><span>                res.sendStatus(<span style=color:#a5d6ff>500</span>);
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            res.sendStatus(<span style=color:#a5d6ff>200</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    } <span style=color:#ff7b72>catch</span> (err) {
</span></span><span style=display:flex><span>        res.sendStatus(<span style=color:#a5d6ff>400</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h1 id=repositories>Repositories<a hidden class=anchor aria-hidden=true href=#repositories>#</a></h1><ul><li><a href=https://github.com/xrazis/form-endpoint/>https://github.com/xrazis/form-endpoint/</a></li><li><a href=https://github.com/xrazis/antamacollective.gr>https://github.com/xrazis/antamacollective.gr</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://haris.razis.com/tags/hugo/>Hugo</a></li><li><a href=https://haris.razis.com/tags/express.js/>Express.js</a></li><li><a href=https://haris.razis.com/tags/node.js/>Node.js</a></li></ul><nav class=paginav><a class=prev href=https://haris.razis.com/posts/building-liferay-widgets-with-react/><span class=title>« Prev</span><br><span>Building Liferay widgets with React</span></a>
<a class=next href=https://haris.razis.com/posts/debugging-unifi-connections/><span class=title>Next »</span><br><span>Debugging Unifi connections</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://haris.razis.com/>xrazis | Haris Razis</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>