<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>resolved.conf | xrazis | Haris Razis</title><meta name=keywords content="Linux,systemd,Networking"><meta name=description content="Unresolvable host workaround"><meta name=author content><link rel=canonical href=/posts/resolved.conf/><link crossorigin=anonymous href=/assets/css/stylesheet.d7fb4cbf980fe688a21621b06a795933c4e6bb2d4070ec940667af1715d84af2.css integrity="sha256-1/tMv5gP5oiiFiGwanlZM8Tmuy1AcOyUBmevFxXYSvI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=favicon.ico><link rel=icon type=image/png sizes=16x16 href=favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon.png><link rel=apple-touch-icon href=apple-touch-icon.png><link rel=mask-icon href=safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="resolved.conf"><meta property="og:description" content="Unresolvable host workaround"><meta property="og:type" content="article"><meta property="og:url" content="/posts/resolved.conf/"><meta property="og:image" content="/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-23T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-23T00:00:00+00:00"><meta property="og:site_name" content="xrazis"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/"><meta name=twitter:title content="resolved.conf"><meta name=twitter:description content="Unresolvable host workaround"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":3,"name":"resolved.conf","item":"/posts/resolved.conf/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"resolved.conf","name":"resolved.conf","description":"Unresolvable host workaround","keywords":["Linux","systemd","Networking"],"articleBody":"Introduction I encountered a weird issue the other day at work where I could not resolve a specific dev server on my laptop. Despite being logged to the company’s VPN and being able to resolve all the other servers, this specific one stubbornly refused. Going through the debugging process of a complex network was not an option, so resolved.conf came to the rescue.\nNetwork Name Resolution configuration files The file resolved.conf is responsible for local DNS and LLNMR (Link-Local Multicast Name Resolution) name resolution. The main file can be found under /etc/systemd and its entries override any defaults. The following configuration was needed for the server to resolve.\n DNS - Define the IPv4/IPv6 entry (or entries) to use as a system DNS servers. Domains - Domains we want to process using the predefined DNS servers. They are processed in the order they are listed, until a match is found.  DNS=195.47.208.14 Domains=opap.local open.local After saving the file with the new entry reload the services as such:\n~ ➜ sudo systemctl daemon-reload  sudo systemctl restart systemd-networkd  sudo systemctl restart systemd-resolved And check that the server now resolves:\n~ ➜ ping tzokerdev.opap.gr -c 4 PING pamdev05.opap.local (10.126.2.45) 56(84) bytes of data. 64 bytes from 10.126.2.45 (10.126.2.45): icmp_seq=1 ttl=63 time=32.9 ms 64 bytes from 10.126.2.45 (10.126.2.45): icmp_seq=2 ttl=63 time=30.5 ms 64 bytes from 10.126.2.45 (10.126.2.45): icmp_seq=3 ttl=63 time=29.5 ms 64 bytes from 10.126.2.45 (10.126.2.45): icmp_seq=4 ttl=63 time=32.8 ms  --- pamdev05.opap.local ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 3004ms rtt min/avg/max/mdev = 29.503/31.433/32.931/1.469 ms ","wordCount":"254","inLanguage":"en","datePublished":"2022-06-23T00:00:00Z","dateModified":"2022-06-23T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/resolved.conf/"},"publisher":{"@type":"Organization","name":"xrazis | Haris Razis","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=/ accesskey=h title="xrazis (Alt + H)">xrazis</a><div class=logo-switches></div></div><ul id=menu><li><a href=/tags/ title=Tags><span>Tags</span></a></li><li><a href=/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href>Home</a>&nbsp;»&nbsp;<a href=/posts/>Posts</a></div><h1 class=post-title>resolved.conf</h1><div class=post-meta><span title="2022-06-23 00:00:00 +0000 UTC">23 June, 2022</span>&nbsp;·&nbsp;2 min&nbsp;|&nbsp;<a href=https://github.com/xrazis/xrazis/tree/master/content/posts/resolved.conf.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#network-name-resolution-configuration-files aria-label="Network Name Resolution configuration files">Network Name Resolution configuration files</a></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>I encountered a weird issue the other day at work where I could not resolve a specific dev server on my laptop. Despite
being logged to the company&rsquo;s VPN and being able to resolve all the other servers, this specific one stubbornly
refused. Going through the debugging process of a complex network was not an option, so <code>resolved.conf</code> came to the
rescue.</p><h1 id=network-name-resolution-configuration-files>Network Name Resolution configuration files<a hidden class=anchor aria-hidden=true href=#network-name-resolution-configuration-files>#</a></h1><p>The file <code>resolved.conf</code> is responsible for local DNS and LLNMR (Link-Local Multicast Name Resolution) name resolution.
The main file can be found under <code>/etc/systemd</code> and its entries override any defaults. The following configuration was
needed for the server to resolve.</p><ol><li><code>DNS</code> - Define the IPv4/IPv6 entry (or entries) to use as a system DNS servers.</li><li><code>Domains</code> - Domains we want to process using the predefined DNS servers. They are processed in the order they are
listed, until a match is found.</li></ol><pre tabindex=0><code class=language-conf data-lang=conf>DNS=195.47.208.14
Domains=opap.local open.local
</code></pre><p>After saving the file with the new entry reload the services as such:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>~
</span></span><span style=display:flex><span>➜ sudo systemctl daemon-reload
</span></span><span style=display:flex><span>  sudo systemctl restart systemd-networkd
</span></span><span style=display:flex><span>  sudo systemctl restart systemd-resolved
</span></span></code></pre></div><p>And check that the server now resolves:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>~
</span></span><span style=display:flex><span>➜ ping tzokerdev.opap.gr -c <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>PING pamdev05.opap.local <span style=color:#f92672>(</span>10.126.2.45<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 10.126.2.45 <span style=color:#f92672>(</span>10.126.2.45<span style=color:#f92672>)</span>: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> time<span style=color:#f92672>=</span>32.9 ms
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 10.126.2.45 <span style=color:#f92672>(</span>10.126.2.45<span style=color:#f92672>)</span>: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> time<span style=color:#f92672>=</span>30.5 ms
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 10.126.2.45 <span style=color:#f92672>(</span>10.126.2.45<span style=color:#f92672>)</span>: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> time<span style=color:#f92672>=</span>29.5 ms
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 10.126.2.45 <span style=color:#f92672>(</span>10.126.2.45<span style=color:#f92672>)</span>: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> time<span style=color:#f92672>=</span>32.8 ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>--- pamdev05.opap.local ping statistics ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> packets transmitted, <span style=color:#ae81ff>4</span> received, 0% packet loss, time 3004ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#f92672>=</span> 29.503/31.433/32.931/1.469 ms
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/linux/>Linux</a></li><li><a href=/tags/systemd/>systemd</a></li><li><a href=/tags/networking/>Networking</a></li></ul><nav class=paginav><a class=next href=/posts/alfacycling/><span class=title>Next »</span><br><span>A naive approach to blogging</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href>xrazis | Haris Razis</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>